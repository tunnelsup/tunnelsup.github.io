
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">

  

  
    <title>Cisco ASA Identity Firewall - TunnelsUP</title>
  
  <!-- <meta name="author" content="Jack"> -->

  
  <meta name="description" content="The Cisco ASA software 8.4.2 introduced something called Identity Firewall. The IDFW gives a new level of control to ACLs. Permit/Deny flows using a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tunnelsup.github.io/cisco-asa-identity-firewall">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="TunnelsUP" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!-- <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.no-icons.min.css" rel="stylesheet"> -->
<!-- <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->
<!-- <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->
<!-- <link href="/stylesheets/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"> -->









</head>

<body   >
  <header role="banner" id="logoblock"><a href="/"><span id="title"><span id="title_tunnel">Tunnels</span><span id="title_up">UP</span><span id="title_com">.com</span></span></a>
<!-- <a href="/"><img class="flex-content" src="/images/tunnelsuplogo.png" alt="TunnelsUp.com" width="527" height="73"></a> -->
</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><i class="icon-search"></i></li>
  
</ul>
  
<form name="search" id="searchform" action="/search/index.html" method="GET">
  <fieldset role="search">
    <input type="text" id="st-search-input" name="stq" class="search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/kb.html">Articles</a></li>
  <li><a href="/tools">Tools</a></li>
  <li><a href="/cheatsheets">Cheat Sheets</a></li>
  <li><a href="/video">Videos</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content"> 
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Cisco ASA Identity Firewall</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-15T16:01:00-07:00" pubdate data-updated="true">Jun 15<span>th</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>The Cisco ASA software 8.4.2 introduced something called Identity Firewall. The IDFW gives a new level of control to ACLs.</p>

<h2>Permit/Deny flows using a user name or user group</h2>

<p>You can now permit/deny traffic flows using a user name or user group.</p>

<p>For instance, look at the last two options when making an ACL:</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>ASA-5505(config)# access-list MYACL ext permit ip ?
</span><span class='line'>configure mode commands/options:
</span><span class='line'>  A.B.C.D            Source IP address
</span><span class='line'>  any                Abbreviation for source address and mask of 0.0.0.0
</span><span class='line'>                     0.0.0.0
</span><span class='line'>  host               Use this keyword to configure source host
</span><span class='line'>  interface          Use interface address as source address
</span><span class='line'>  object             Keyword to enter source object name
</span><span class='line'>  object-group       Network object-group for source address
</span><span class='line'>  object-group-user  User object-group for source address
</span><span class='line'>  user               User for source address [&lt;domain_nickname&gt;\]&lt;user_name&gt;
</span><span class='line'>  user-group         User-group for source address
</span><span class='line'>                     [&lt;domain_nickname&gt;\\]&lt;user_group_name&gt;</span></code></pre></td></tr></table></div></figure>


<p>In order for the firewall to map an IP to a username it has to integrate with a domain controller and an AD agent. The AD agent is a program that Cisco has made that is installed on the AD server. It essentially sends the ASA a map of what user has connected with what IP. The ASA then can make decisions on who to block because it knows what each user&rsquo;s IP is.</p>

<p>The ASA uses the global <code>user-identity</code> commands to configure this.</p>

<p>To learn more about installing the AD agent review this link: <a href="http://www.cisco.com/en/US/docs/security/ibf/setup_guide/ad_agent_setup_guide.html">http://www.cisco.com/en/US/docs/security/ibf/setup_guide/ad_agent_setup_guide.html</a></p>

<h2>Permit/Deny Domain Names</h2>

<p>Also in 8.4.2 there is the ability to block a domain name. This is something we&rsquo;ve all been looking forward to for a long time.</p>

<h4>Configure the ASA to resolve DNS</h4>

<p>In order for the firewall to block a domain name it has to be able to resolve domain names. Use your own DNS server if you have it. Otherwise using a public DNS server will look something like this:</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>dns domain-lookup OUTSIDE
</span><span class='line'>DNS server-group DefaultDNS
</span><span class='line'>    name-server 4.2.2.2</span></code></pre></td></tr></table></div></figure>


<p>Make sure you can ping a url like google.com from the firewall to verify your ASA is resolving DNS correctly.</p>

<h4>Create the object</h4>

<p>Suppose we want to block access to Google.com. Create an object with google.com in it.</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>object network OBJ-GOOGLE.COM
</span><span class='line'> fqdn google.com</span></code></pre></td></tr></table></div></figure>


<h4>Add the object to an ACL</h4>

<p>Now it&rsquo;s just a matter of adding it to the right ACL. Here is what the command looks like:</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>access-list ACL-INSIDE line 1 extended deny ip any object OBJ-GOOGLE.COM</span></code></pre></td></tr></table></div></figure>


<p>This is what it should look like after you do a <code>show access-list</code><br></p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>access-list ACL-INSIDE line 1 extended deny ip any object OBJ-GOOGLE.COM 0x8e6d59a8 
</span><span class='line'>access-list ACL-INSIDE line 1 extended deny ip any fqdn google.com (resolved) 0x827c8780 
</span><span class='line'>access-list ACL-INSIDE line 1 extended deny ip any host 74.125.224.163 (google.com) (hitcnt=73) 0x8e6d59a8 
</span><span class='line'>access-list ACL-INSIDE line 1 extended deny ip any host 74.125.224.165 (google.com) (hitcnt=3) 0x8e6d59a8 
</span><span class='line'>access-list ACL-INSIDE line 1 extended deny ip any host 74.125.224.162 (google.com) (hitcnt=7) 0x8e6d59a8 
</span><span class='line'>access-list ACL-INSIDE line 1 extended deny ip any host 74.125.224.169 (google.com) (hitcnt=23) 0x8e6d59a8 
</span><span class='line'>access-list ACL-INSIDE line 1 extended deny ip any host 74.125.224.174 (google.com) (hitcnt=130) 0x8e6d59a8 
</span><span class='line'>access-list ACL-INSIDE line 1 extended deny ip any host 74.125.224.164 (google.com) (hitcnt=21) 0x8e6d59a8 
</span><span class='line'>access-list ACL-INSIDE line 1 extended deny ip any host 74.125.224.168 (google.com) (hitcnt=14) 0x8e6d59a8 
</span><span class='line'>access-list ACL-INSIDE line 1 extended deny ip any host 74.125.224.161 (google.com) (hitcnt=12) 0x8e6d59a8 
</span><span class='line'>access-list ACL-INSIDE line 1 extended deny ip any host 74.125.224.167 (google.com) (hitcnt=3) 0x8e6d59a8 
</span><span class='line'>access-list ACL-INSIDE line 1 extended deny ip any host 74.125.224.160 (google.com) (hitcnt=20) 0x8e6d59a8 
</span><span class='line'>access-list ACL-INSIDE line 1 extended deny ip any host 74.125.224.166 (google.com) (hitcnt=4) 0x8e6d59a8 </span></code></pre></td></tr></table></div></figure>


<p>Notice the ASA resolved the domain name and added all of the IPs in the ACL. This will be updated based on the TTL of the DNS request it made to resolve the IP.</p>

<p>And this is what the syslog looks like:</p>

<p><code>Mar 23 2012 11:58:07: %ASA-4-106023: Deny tcp src INSIDE:172.16.2.21/2414 dst OUTSIDE:74.125.224.160/443(google.com) by access-group "ACL-INSIDE" [0x1e144444,0x1e144444]</code></p>

<p>A cool thing about this solution is that it doesn&rsquo;t slow down the firewall at all. It does the DNS look up probably once every few hours for when the TTL expires and then stores the IPs in memory. In other words it does not do a DNS lookup for every packet that comes through the firewall, it does it before hand.</p>

<p>What I also like about this solution is that this works for both HTTPS and HTTP. The firewall doesn&rsquo;t inspect domain names or URLs and it doesn&rsquo;t care if the packet is encrypted or not. The packet has to have a destination IP and that&rsquo;s what the firewall will check.</p>

<p><strong> Special Note:</strong> This does not resolve all subdomain of google like www.google.com, mail.google.com, maps.google.com etc. You&rsquo;ll have to create a seperate object for each of these domains to cover all the bases.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jack</span></span>

      








  


<time datetime="2013-06-15T16:01:00-07:00" pubdate data-updated="true">Jun 15<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/tup/tag/ad/'>ad</a>, <a class='category' href='/tup/tag/asa/'>asa</a>, <a class='category' href='/tup/tag/cisco/'>cisco</a>, <a class='category' href='/tup/tag/firewall/'>firewall</a>, <a class='category' href='/tup/tag/identity/'>identity</a>, <a class='category' href='/tup/tag/idfw/'>idfw</a>, <a class='category' href='/tup/tag/scripts/'>scripts</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://tunnelsup.github.io/cisco-asa-identity-firewall/" data-via="tunnelsup" data-counturl="http://tunnelsup.github.io/cisco-asa-identity-firewall/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <script type="text/javascript"><!--
google_ad_client = "ca-pub-3148884705608664";
/* TunnelsUp - Leaderboard Footer */
google_ad_slot = "4691437304";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
  </footer>
</article>

  <div class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </div>

</div>

<aside class="sidebar">
  
    <div class="asidesection">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-3148884705608664";
/* TunnelsUp - sidebar Square */
google_ad_slot = "7251074508";
google_ad_width = 200;
google_ad_height = 200;
//-->
</script>
<script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div><div class="asidesection">
<h3>Featured Tool</h3>
<a href="/subnet-calculator">Subnet Calculator</a><br>
This subnet calculator is the most simple and user friendly one out there. Give it a try. It might become your favorite. 
</div>
<div class="asidesection">
<h3>Password Generator</h3>
<img class="left" src="/images/passwordwolf.png" width="50" title="PasswordWolf" alt="PasswordWolf">
PasswordWolf.com is a fantastic <a href="https://passwordwolf.com/">random password generator.</a> Try it today!
</div><div class="asidesection">
 <h3>Support this blog!</h3>
 <p><a href="/donate.html"><img style="border:0px" src="/images/paypaldonatebutton.gif" alt="donate"></a></p>
</div><div class="asidesection">
<h3>Popular Links</h3>
  <ul id="recent_posts">
      <li class="post"><a href="/how-to-take-a-screenshot-on-mac-osx/">How to Take a Screenshot Mac OSX</a></li>
      <li class="post"><a href="/what-is-ping/">What is a Ping?</a></li>
      <li class="post"><a href="/what-is-a-vpn/">What is a VPN?</a></li>
      <li class="post"><a href="/what-is-a-firewall/">What is a Firewall?</a></li>
      <li class="post"><a href="/jquery-checkbox-checked-reading-and-setting/">jQuery Checkbox Checked</a></li>
  </ul>
</div>
<section class="twitterOct">
	<br>
  	<a class="twitter-timeline"
	 data-dnt="true" href="https://twitter.com/tunnelsup" 
     data-widget-id="736235600487931906">
     
     Tweets by @tunnelsup
  </a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Jack - <a href="/about">About This Site</a>
  ---
  <a href="/links">Links to other useful websites</a>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tunnelsup';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://tunnelsup.github.io/cisco-asa-identity-firewall/';
        var disqus_url = 'http://tunnelsup.github.io/cisco-asa-identity-firewall/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





<!-- <script src="/javascripts/modernizr-2.0.js"></script> -->
<!-- <script src="/javascripts/jquery.min.js"></script> -->
<!-- <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script> -->
<!-- <script src="/javascripts/octopress.js" type="text/javascript"></script> -->

  <script src="/javascripts/all.min.js" type="text/javascript"></script>





<script type="text/javascript">
  $('#searchform').submit(function(event) {
     window.location.href = "/search/index.html#stq=" + document.search.stq.value;
     event.preventDefault();
  });
</script>


  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2202347-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>






</body>
</html>
