
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">

  

  
    <title>Making Postfix RFC Compliant - TunnelsUP</title>
  
  <!-- <meta name="author" content="Jack"> -->

  
  <meta name="description" content="By default Postfix is not RFC compliant. Here are some helpful tips to getting your Postfix installation conform to the email RFCs. What is RFC? &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://www.tunnelsup.com/making-postfix-rfc-compliant">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="TunnelsUP" type="application/atom+xml">
  <link rel="image_src" href="/images/tup-logo.png">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!-- <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.no-icons.min.css" rel="stylesheet"> -->
<!-- <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->
<!-- <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->
<!-- <link href="/stylesheets/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"> -->









</head>

<body   >
  <header role="banner" id="logoblock"><a href="/"><span id="title"><span id="title_tunnel">Tunnels</span><span id="title_up">UP</span><span id="title_com">.com</span></span></a>
<!-- <a href="/"><img class="flex-content" src="/images/tunnelsuplogo.png" alt="TunnelsUp.com" width="527" height="73"></a> -->
</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><i class="icon-search"></i></li>
  
</ul>
  
<form name="search" id="searchform" action="/search/index.html" method="GET">
  <fieldset role="search">
    <input type="text" id="st-search-input" name="stq" class="search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/kb.html">Articles</a></li>
  <li><a href="/tools">Tools</a></li>
  <li><a href="/cheatsheets">Cheat Sheets</a></li>
  <li><a href="/video">Videos</a></li>
  <!-- <li><a href="https://shop.tunnelsup.com">Shop</a></li> -->
</ul>

</nav>
  <div id="main">
    <div id="content"> 
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Making Postfix RFC Compliant</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-02-14T20:47:00-08:00" pubdate data-updated="true">Feb 14<span>th</span>, 2015</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>By default <a href="http://www.postfix.org/">Postfix</a> is not RFC compliant. Here are some helpful tips to getting your Postfix installation conform to the email RFCs.</p>

<h3>What is RFC?</h3>

<p>Mainly this document is covering <a href="http://tools.ietf.org/html/rfc2821">RFC 2821</a>. This is publication created by the Internet Engineering Task Force (IETF) which aims to standardize how the SMTP protocol should behave. By adhering to the standard you will be promoting best practices and taking steps to safeguarding your mail server from abusers.</p>

<h3>Require HELO</h3>

<p>In the <code>/etc/postfix/main.cf</code> add the following:</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>smtpd_helo_required = yes</span></code></pre></td></tr></table></div></figure>


<p>This makes sure that clients introduce themselves properly before continuing. It means the first command accepted from the client is &ldquo;EHLO&rdquo; or &ldquo;HELO&rdquo;.</p>

<h3>SMTP Recipient Restrictions</h3>

<p>Again in <code>main.cf</code> add the following lines:</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>smtpd_recipient_restrictions = 
</span><span class='line'> reject_non_fqdn_sender
</span><span class='line'> reject_non_fqdn_recipient
</span><span class='line'> reject_unknown_sender_domain
</span><span class='line'> reject_unknown_recipient_domain
</span><span class='line'> permit_mynetworks
</span><span class='line'> reject_unauth_destinations
</span><span class='line'> reject_multi_recipient_bounce
</span><span class='line'> reject_non_fqdn_hostname
</span><span class='line'> reject_invalid_hostname
</span><span class='line'> permit</span></code></pre></td></tr></table></div></figure>


<p>If you have other permits such as <code>permit_sasl_authenticated</code>, that should go right after <code>permit_mynetowrks</code>.</p>

<p>The <a href="http://www.postfix.org/postconf.5.html#smtpd_recipient_restrictions">smtp_recipient_restrictions</a> command specifies what mail postfix should receive. This actually applies to both incoming and outgoing mail because in either destination postfix still has to make the decision on whether to accept the message or not.</p>

<p>The way this command works is that the checks stop on the first match. The default policy at the end is to permit everything else. We add the permit statement so this is more clear. Our goal is to block all traffic that does not conform to RFC standards or isn&rsquo;t on our network or isn&rsquo;t a legitimate user. If the message passes all the reject checks then it finally gets permitted.</p>

<p>The order of operation is important because if you notice up to and including the first permit these checks will be applied to both internal and external users. The permits in the middle (in case you added sasl permit too) will permit any internal user or authenticated user trying to send mail to somewhere else. If there is a match on these permits then the rest of the checks never get checked. The remaining reject checks will only be applied to external clients trying to send mail inbound to Postfix.</p>

<h5>reject_non_fqdn_sender</h5>

<p>The RFC requires a fully qualified domain names for both sender and recipient. This command will reject &lsquo;sender&rsquo; or &lsquo;from&rsquo; fields that contain partial domain names. For instance with this line, Postfix will reject mail from <code>example@example</code>. The domain portion of this address is not a FQDN and probably should have been written as <code>example@example.com</code>.</p>

<h5>reject_non_fqdn_recipient</h5>

<p>This command will reject the &lsquo;recipient&rsquo; or &lsquo;to&rsquo; fields from containing a partial domain name in the server portion of the address.</p>

<h5>reject_unknown_sender_domain</h5>

<p>This setting will attempt to do a DNS lookup on the &lsquo;sender&rsquo; or &lsquo;from&rsquo; domain name. If the &lsquo;from&rsquo; field states <code>example@no.such.domain</code> the Postfix server will reject this because it cannot resolve <code>no.such.domain</code>.</p>

<h5>reject_unknown_recipient_domain</h5>

<p>This setting will attempt to do a DNS lookup on the &lsquo;recipient&rsquo; or &lsquo;to&rsquo; domain name.</p>

<h5>reject_unauth_destinations</h5>

<p>This setting will check if recipient domain is something that Postfix responds to.</p>

<h5>reject_non_fqdn_hostname</h5>

<p>This setting requires clients to complete the HELO with their FQDN. The RFC requires an FQDN be presented in the initial HELO.</p>

<h5>reject_invalid_hostname</h5>

<p>This setting will reject hostnames that are incomplete or use invalid characters. This step is checked at the initial HELO.</p>

<h3>Mandatory accounts</h3>

<p>According to both RFC2821 and <a href="http://tools.ietf.org/html/rfc2142">RFC2142</a> these addresses should be valid.</p>

<ul>
<li>postmaster</li>
<li>abuse</li>
<li>webmaster (if running a webserver)</li>
<li>hostmaster (if running a DNS server)</li>
</ul>


<p>That is if your mail domain is example.com you must accept mail for <code>postmaster@example.com</code> to be compliant.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jack</span></span>

      








  


<time datetime="2015-02-14T20:47:00-08:00" pubdate data-updated="true">Feb 14<span>th</span>, 2015</time>
      

<span class="categories">
  
    <a class='category' href='/tup/tag/misc/'>misc</a>, <a class='category' href='/tup/tag/postfix/'>postfix</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="https://www.tunnelsup.com/making-postfix-rfc-compliant/" data-via="tunnelsup" data-counturl="https://www.tunnelsup.com/making-postfix-rfc-compliant/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <script type="text/javascript"><!--
google_ad_client = "ca-pub-3148884705608664";
/* TunnelsUp - Leaderboard Footer */
google_ad_slot = "4691437304";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
  </footer>
</article>

  <div class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </div>

</div>

<aside class="sidebar">
  
    <div class="asidesection">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-3148884705608664";
/* TunnelsUp - sidebar Square */
google_ad_slot = "7251074508";
google_ad_width = 200;
google_ad_height = 200;
//-->
</script>
<script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div><div class="asidesection">
<h3>Podcast</h3>
<a href="https://darknetdiaries.com">
<img class="left" src="/images/darknet.png" width="250" title="Darknet Diaries" alt="Darknet Diaries">
A podcast exploring true stories from the dark side of the Internet.
</a>
</div><div class="asidesection">
<h3>Get lost with Carlos Castaneda</h3>
<a href="https://allthingsforthewin.com/2018/01/23/whats-inside-carlos-castaneda-books/"><img class="left" src="https://allthingsforthewin.files.wordpress.com/2018/01/castaneda-books.jpg" width="250" title="Carlos Castaneda" alt="Carlos Castaneda"></a>
These books could have a powerful impact on your life. <a href="https://allthingsforthewin.com/2018/01/23/whats-inside-carlos-castaneda-books/">See what's inside.</a>
</div><div class="asidesection">
<h3>Subscribe</h3>

<!-- Begin MailChimp Signup Form -->

<div id="mc_embed_signup">
<form action="//tunnelsup.us1.list-manage.com/subscribe/post?u=e1ed6534432d35708d1d0d7d8&amp;id=6f7babd538" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	Subscribe to the TunnelsUp mailing list and get tips, early access to new tools, and info about training opportunities.
<div class="mc-field-group">
	<input type="email" placeholder="Email Address" value="" name="EMAIL" class="required email formsize-md" id="mce-EMAIL">
</div>
	<div id="mce-responses" class="clear">
		<div class="response" id="mce-error-response" style="display:none"></div>
		<div class="response" id="mce-success-response" style="display:none"></div>
	</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_e1ed6534432d35708d1d0d7d8_6f7babd538" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button btn btn-default"></div>
    </div>
</form>
</div>
<script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
<!--End mc_embed_signup-->
</div>




<div class="asidesection">
<h3>Popular Links</h3>
  <ul id="recent_posts">
      <li class="post"><a href="/how-to-take-a-screenshot-on-mac-osx/">How to Take a Screenshot Mac OSX</a></li>
      <li class="post"><a href="/what-is-ping/">What is a Ping?</a></li>
      <li class="post"><a href="/what-is-a-vpn/">What is a VPN?</a></li>
      <li class="post"><a href="/what-is-a-firewall/">What is a Firewall?</a></li>
      <li class="post"><a href="/jquery-checkbox-checked-reading-and-setting/">jQuery Checkbox Checked</a></li>
  </ul>
</div>
<section class="twitterOct">
	<br>
  	<a class="twitter-timeline"
	 data-dnt="true" href="https://twitter.com/tunnelsup" 
     data-widget-id="736235600487931906">
     
     Tweets by @tunnelsup
  </a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Jack - <a href="/about">About This Site</a>
  ---
  <a href="/links">Links to other useful websites</a>
  --- 
  <a href="https://kronology.com">Personal Timeline Maker</a>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tunnelsup';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://www.tunnelsup.com/making-postfix-rfc-compliant/';
        var disqus_url = 'https://www.tunnelsup.com/making-postfix-rfc-compliant/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





<!-- <script src="/javascripts/modernizr-2.0.js"></script> -->
<!-- <script src="/javascripts/jquery.min.js"></script> -->
<!-- <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script> -->
<!-- <script src="/javascripts/octopress.js" type="text/javascript"></script> -->

  <script src="/javascripts/all.min.js" type="text/javascript"></script>





<script type="text/javascript">
  $('#searchform').submit(function(event) {
     window.location.href = "/search/index.html#stq=" + document.search.stq.value;
     event.preventDefault();
  });
</script>


  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2202347-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>






</body>
</html>
