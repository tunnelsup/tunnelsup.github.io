<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: asa | TunnelsUP]]></title>
  <link href="https://www.tunnelsup.com/tup/tag/asa/atom.xml" rel="self"/>
  <link href="https://www.tunnelsup.com/"/>
  <updated>2017-05-17T23:33:25-07:00</updated>
  <id>https://www.tunnelsup.com/</id>
  <author>
    <name><![CDATA[Jack]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[How to Upgrade a Cisco ASA Firewall]]></title>
    <link href="https://www.tunnelsup.com/how-to-upgrade-a-cisco-asa-firewall/"/>
    <updated>2017-05-17T22:40:00-07:00</updated>
    <id>https://www.tunnelsup.com/how-to-upgrade-a-cisco-asa-firewall</id>
    <content type="html"><![CDATA[<p>To upgrade the OS of a Cisco ASA firewall follow these basic steps:</p>

<ol>
<li>Download Software</li>
<li>Get Software on ASA</li>
<li>Verify Software</li>
<li>Configure ASA</li>
<li>Reboot ASA</li>
</ol>


<h3>Download Software</h3>

<p>The general suggestion is to run the latest version of ASA OS version that the ASA supports. The OS image contains the entire OS. There are no such things as patches or updates. You download a whole new OS to be installed. Because of this there usually isn&rsquo;t a need to do a stepped upgrade. The only time you need to do a <a href="/cisco-asa-upgrade-path/">stepped upgrade is when you&rsquo;re upgrading from a very old version (pre 9.1)</a> and want the config to be migrated for you.</p>

<p>Go to the downloads section of Cisco.com (requires Cisco login with valid support contract): <a href="https://software.cisco.com/download">https://software.cisco.com/download/</a></p>

<p><strong>ASA Without FirePower IPS</strong></p>

<p>Navigate to <strong>Security</strong> > <strong>Firewalls</strong> > <strong>Adaptive Security Appliace (ASA)</strong> > <strong>ASA Model</strong> > <strong>Software on Chassis</strong> > <strong>Adaptive Security Appliance (ASA) Software</strong>.</p>

<p><strong>ASA With FirePower IPS</strong></p>

<p>Navigate to <strong>Security</strong> > <strong>Firewalls</strong> > <strong>Next-Generation Firewalls (NGFW)</strong> > <strong>ASA 5500-X with FirePOWER Services</strong> > <strong>Model of ASA</strong> > <strong>Adaptive Security Appliance (ASA) Software</strong></p>

<blockquote><p>When downloading the software, hover over the image on the downloads page to see the Checksum. Copy this checksum as we&rsquo;ll use it to verify the image later.</p></blockquote>

<h4>Understanding Versions</h4>

<p>Unlike a Cisco Router image, the ASA image contains all features and requires additional licenses to unlock the features. This makes choosing the image a lot easier but makes handling licensing harder.</p>

<p>The OS image file will look like one of these 3:</p>

<p><code>asa933-7-lfbff-k8.SPA</code><br>
<code>asa924-5-smp-K8.bin</code><br>
<code>asa924-5-k8.bin</code></p>

<p>The numbers indicate the version. For instance the first file here is for ASA OS Version 9.3(3)7.</p>

<p>The <code>lfbff</code> and <code>SPA</code> indicates it has FirePower IPS included in the image and this image is digitally signed which makes it tamper resistant.</p>

<p>The <code>smp</code> indicates the image is for a multi-core ASA (check how many cores using show ver).</p>

<p>The 3rd one is for old ASAs that have a single core.</p>

<p>The <code>k8</code> tag indicates this image supports DES encryption. With a license, you can make the ASA support AES and 3DES.</p>

<p>These images aren&rsquo;t tied to a model number, so the image downloaded for a 5512x can also be used on a 5516x.</p>

<h2>Get Software on ASA</h2>

<p>Once you have downloaded the image, upload it to the ASA.</p>

<p>Upload the image to an http or ftp server and copy the image to the ASA from the ASA command line with one of these commands:</p>

<p><code>copy http flash</code></p>

<p><code>copy ftp flash</code></p>

<p><code>copy tftp flash</code></p>

<p>You can also use a USB flash drive to put the image on and insert it into the ASA.</p>

<p><code>dir /all</code> will show you all the files on all disks</p>

<p><code>copy disk1:/filename flash</code></p>

<p>It is also possible to upload the image using the ASDM.</p>

<h2>Verify Software</h2>

<p>Now that the software is on the ASA you want to verify it got there without any errors. To do this, use the <code>verify</code> CLI command:</p>

<p><code>verify disk0:/asaxxxxxxxx.xxx</code></p>

<p>Now compare the checksum output to the checksum you saw on the downloads page from Cisco.com. If they match then this image is not corrupt.</p>

<h2>Configure ASA</h2>

<p>Apply the image to the ASA with the <code>boot system</code> command like this:</p>

<p><code>boot system disk0:/asa962-13-lfbff-k8.SPA</code></p>

<p>This will tell the ASA to boot to that image the next time there is a reboot.</p>

<h2>Reboot ASA</h2>

<p>Lastly, reboot the ASA. When it comes back up, check the version doing a <code>show ver</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ASA5506x Fits In A 5505 Rack Mount]]></title>
    <link href="https://www.tunnelsup.com/asa5505x-fits-in-a-5505-rack-mount/"/>
    <updated>2016-11-01T22:30:00-07:00</updated>
    <id>https://www.tunnelsup.com/asa5505x-fits-in-a-5505-rack-mount</id>
    <content type="html"><![CDATA[<p>The rack mount kits for a Cisco ASA 5506x (Part number ASA-5506-RACK-MNT=) are going for over $250! That&rsquo;s almost as much as the firewall itself! This is ridiculously high.</p>

<p>But don&rsquo;t panic! You can get an older ASA 5505 rack mount kit and the 5506x will fit inside it. The older ASA 5505 mounts go for $60 or less and seem to be ok. Here are some pics from a recent swap I did.</p>

<p>ASA 5505 in an 5505 rack mount.
<img src="/images/asarack1.jpg"></p>

<p>ASA 5506x in a 5505 rack mount.
<img src="/images/asarack2.jpg"></p>

<p>ASA 5506x in a 5505 rack mount.
<img src="/images/asarack3.jpg"></p>

<p>The one problem here is that the 5506-X is longer than the 5505. This means you may have to secure it using some zip ties or something if you don&rsquo;t want it to slide around every time you put a cable in. In my case I added a few pieces of tape to keep it from moving and it worked great.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cisco ASA command to show listening ports]]></title>
    <link href="https://www.tunnelsup.com/cisco-asa-command-to-show-listening-ports/"/>
    <updated>2016-09-29T15:05:00-07:00</updated>
    <id>https://www.tunnelsup.com/cisco-asa-command-to-show-listening-ports</id>
    <content type="html"><![CDATA[<p>Do you wish there was a <code>netstat</code> command for a Cisco ASA? Are you looking to see what ports the ASA has open and is listening on? Try this command:</p>

<p>```
ASA5506# sh asp table socket</p>

<p>Protocol  Socket    State      Local Address        Foreign Address
SSL       0001ebf8  LISTEN     172.16.3.1:443       0.0.0.0:<em>
TCP       000216f8  LISTEN     172.16.3.1:22        0.0.0.0:</em>
TCP       370c1d68  LISTEN     99.99.99.99:22       0.0.0.0:*
TCP       3712d678  ESTAB      172.16.3.1:22        172.16.2.3:50233
```</p>

<p>This command displays all of the ports that are open and established on the ASA.</p>

<p>The <code>state</code> indicates whether the port is listening or established.</p>

<p>The <code>local address</code> says which IP it&rsquo;s listening on. In the example above, 99.99.99.99 is the outside interface and the 172.16.3.1 is the inside interface.</p>

<p>The <code>foreign address</code> will show up when someone connects to that port. In this case I was ssh&rsquo;d into the firewall coming from 172.16.2.3.</p>

<p>The output above should be a direct reflection of the <code>ssh</code>, <code>telnet</code>, and <code>http</code> commands in the ASA.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to show and clear user sessions on a Cisco ASA]]></title>
    <link href="https://www.tunnelsup.com/how-to-show-and-clear-user-sessions-on-a-cisco-asa/"/>
    <updated>2016-06-18T16:36:00-07:00</updated>
    <id>https://www.tunnelsup.com/how-to-show-and-clear-user-sessions-on-a-cisco-asa</id>
    <content type="html"><![CDATA[<p>Sometimes you need to disconnect someone&rsquo;s ssh session to a Cisco ASA. This may be needed because users haven&rsquo;t logged out properly and have taken up all the sessions allowed.</p>

<h2>Check Usage Limits</h2>

<p>You can check usage limits by seeing how many sessions the ASA <em>thinks</em> are connected.</p>

<p><code>
FWL1# show resource usage resource ssh
Resource                 Current        Peak      Limit        Denied Context
SSH Server                     5           5          5           109 System
</code></p>

<p>In this case the ASA can only connect 5 years and it thinks there are 5 sessions open and therefore it cannot connect any more.</p>

<p>There&rsquo;s a bug that doesn&rsquo;t properly release sessions from the ASA. <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCsm68097">https://bst.cloudapps.cisco.com/bugsearch/bug/CSCsm68097</a></p>

<h2>Show current ssh sessions</h2>

<p>To display all ssh sessions connected run this command.</p>

<p>```
FWL1# show ssh sessions                      <br/>
SID Client IP       Version Mode Encryption Hmac     State            Username
0   10.1.1.21       2.0     IN   aes128-ctr sha1     SessionStarted   james</p>

<pre><code>                        OUT  aes128-ctr sha1     SessionStarted   james
</code></pre>

<p>2   10.1.1.22       2.0     IN   aes128-ctr sha1     SessionStarted   frank</p>

<pre><code>                        OUT  aes128-ctr sha1     SessionStarted   frank
</code></pre>

<p>3   10.1.1.20       2.0     IN   aes128-ctr sha1     SessionStarted   henry</p>

<pre><code>                        OUT  aes128-ctr sha1     SessionStarted   henry
</code></pre>

<p>```</p>

<h2>Disconnect user</h2>

<p>If you want to disconnect user henry, find the SID and use this command:</p>

<p><code>
FWL1# ssh disconnect 3
</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Starter Config for Cisco ASA 5506]]></title>
    <link href="https://www.tunnelsup.com/starter-config-for-cisco-asa-5506/"/>
    <updated>2016-04-16T22:46:00-07:00</updated>
    <id>https://www.tunnelsup.com/starter-config-for-cisco-asa-5506</id>
    <content type="html"><![CDATA[<p>Are you trying to set up a Cisco ASA 5506 for the first time and want to see a sample config to get you started? Well then here&rsquo;s a good template to get started with. A 5506 is often intended for a small office or home office. In our scenario there is no DMZ and we are connecting to a cable modem using DHCP.</p>

<p>Here is a basic template you can use to get started with quickly. These commands will work with any ASA version 8.3 and up. I would say this will work with any ASA version 7.2 and up, except the NAT command and DHCP commands would not work.
```
!
hostname My-Firewall
enable password mysekretspecialenablepassw0rd
!
interface GigabitEthernet1/1
 nameif OUTSIDE
 security-level 0
 ip address dhcp setroute
!
interface GigabitEthernet1/2
 nameif INSIDE
 security-level 100
 ip address 192.168.55.1 255.255.255.0
!
interface GigabitEthernet1/3
 shutdown
 no nameif
 no security-level
 no ip address
!
interface GigabitEthernet1/4
 shutdown
 no nameif
 no security-level
 no ip address
!
interface GigabitEthernet1/5
 shutdown
 no nameif
 no security-level
 no ip address
!
interface GigabitEthernet1/6
 shutdown
 no nameif
 no security-level
 no ip address
!
interface GigabitEthernet1/7
 shutdown
 no nameif
 no security-level
 no ip address
!
interface GigabitEthernet1/8
 shutdown
 no nameif
 no security-level
 no ip address
!
interface Management1/1
 management-only
 no nameif
 no security-level
 no ip address
!
ftp mode passive
clock timezone PDT -7
object-group network OBJ-INSIDE-NETWORKS
 network-object 192.168.55.0 255.255.255.0
 network-object 192.168.56.0 255.255.255.0
access-list ACL-OUTSIDE-IN extended permit icmp any any echo-reply
access-list ACL-OUTSIDE-IN extended deny ip any any
access-list ACL-INSIDE-IN extended permit ip object-group OBJ-INSIDE-NETWORKS any
access-list ACL-INSIDE-IN extended deny ip any any
pager lines 24
logging enable
logging timestamp
logging monitor notifications
logging buffered notifications
logging asdm informational
mtu OUTSIDE 1500
mtu INSIDE 1500
icmp unreachable rate-limit 1 burst-size 1
no asdm history enable
arp timeout 14400
no arp permit-nonconnected
nat (INSIDE,OUTSIDE) source dynamic any interface description Main PAT
access-group ACL-OUTSIDE-IN in interface OUTSIDE
access-group ACL-INSIDE-IN in interface INSIDE</p>

<p>route INSIDE 192.168.56.0 255.255.255.0 192.168.55.2 1
timeout xlate 3:00:00
timeout pat-xlate 0:00:30
timeout conn 1:00:00 half-closed 0:10:00 udp 0:02:00 icmp 0:00:02
timeout sunrpc 0:10:00 h323 0:05:00 h225 1:00:00 mgcp 0:05:00 mgcp-pat 0:05:00
timeout sip 0:30:00 sip_media 0:02:00 sip-invite 0:03:00 sip-disconnect 0:02:00
timeout sip-provisional-media 0:02:00 uauth 0:05:00 absolute
timeout tcp-proxy-reassembly 0:01:00
timeout floating-conn 0:00:00
user-identity default-domain LOCAL
aaa authentication ssh console LOCAL
aaa authentication enable console LOCAL
aaa authentication http console LOCAL
no snmp-server location
no snmp-server contact
service sw-reset-button
crypto ipsec security-association pmtu-aging infinite
crypto ca trustpool policy
telnet timeout 5
no ssh stricthostkeycheck
ssh 0.0.0.0 0.0.0.0 INSIDE
ssh timeout 60
ssh key-exchange group dh-group1-sha1
console timeout 0
dhcpd auto_config OUTSIDE
!
dhcpd address 192.168.55.50-192.168.55.150 INSIDE
dhcpd enable INSIDE
!
threat-detection basic-threat
threat-detection statistics access-list
no threat-detection statistics tcp-intercept
dynamic-access-policy-record DfltAccessPolicy
username johndoe password oVIhyCAOOHIOur6g encrypted privilege 15
!
class-map inspection_default
 match default-inspection-traffic
!
!
policy-map type inspect dns preset_dns_map
 parameters
  message-length maximum client auto
  message-length maximum 512
policy-map global_policy
 class inspection_default
  inspect dns preset_dns_map
  inspect ftp
  inspect h323 h225
  inspect h323 ras
  inspect rsh
  inspect rtsp
  inspect esmtp
  inspect sqlnet
  inspect skinny<br/>
  inspect sunrpc
  inspect xdmcp
  inspect sip<br/>
  inspect netbios
  inspect tftp
  inspect ip-options
!
service-policy global_policy global
prompt hostname context
```</p>

<h3>Breakdown of commands</h3>

<ol>
<li><p>Set the interface configuration. In this template Gig1/1 is OUTSIDE and Gig1/2 is INSIDE. The OUTSIDE route is not only DHCP but I want it to be the default route. That&rsquo;s why the <code>setroute</code> command is there. The INSIDE interface has a static IP. Security level on the outside or untrusted network should always be higher than the inside or trusted network.</p></li>
<li><p>Create a NAT. In the template above there&rsquo;s only one PAT. This is important so all outgoing traffic can go through the firewall and get NAT&rsquo;d to the outside IP of the firewall.</p></li>
<li><p>Set any routes. In the example above we have the 192.168.56.0/24 network on the inside so we made a route for it. If there are no extra networks on the inside then we don&rsquo;t need this.</p></li>
<li><p>Set the ACLs. This is important to configure so it stops all incoming attacks to your network. The example above permits only ICMP (ping) replies and then denies everything else on the outside interface. Because a firewall is stateful, it will remember and permit any traffic originating from the inside and permit it back in. Essentially the template configuration let&rsquo;s you go out to the internet, but doesn&rsquo;t let any unwanted traffic in. I like to set the inside interface to only permit what I know exists inside my network. This is why the inside ACL permits only the inside networks.</p></li>
<li><p>Create a username and set the AAA configuration. In this case we created a johndoe username and set the <code>ssh</code> and <code>aaa</code> commands. This creates a user, configures logon settings, and permits ssh capabilities to the firewalls. You may want to lookup how to set up ssh for your ASA since you need to generate keys to do so.</p></li>
<li><p>Create a DHCP server (Optional). If you need to dynamically give DHCP addresses to hosts connecting to the ASA you can configure DHCP on the ASA to handle this. These commands are in the template. The <code>auto_config</code> command should pull any domain info and DNS servers out of the outside interface that uses DHCP to get it&rsquo;s information. If it doesn&rsquo;t then you can manually set the DNS server using <code>dhcpd dns 4.2.2.2</code>.</p></li>
</ol>

]]></content>
  </entry>
  
</feed>
